<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Raspanti Docente</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        raspanti: { bordo: '#800020', crema: '#FFFDD0', dorado: '#C5B358' }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { background-color: #F8FAFC; -webkit-tap-highlight-color: transparent; font-family: system-ui, sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Ocultar scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="h-screen flex flex-col text-slate-800 bg-slate-50">

    <div id="auth-screen" class="fixed inset-0 bg-raspanti-bordo z-50 flex flex-col items-center justify-center p-6 text-center text-white">
        <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center border-4 border-raspanti-dorado mb-6 text-raspanti-bordo text-4xl font-black">R</div>
        <h1 class="text-2xl font-bold uppercase mb-8">Instituto Raspanti<br><span class="text-raspanti-dorado text-sm">Agenda Docente</span></h1>
        <button onclick="login()" class="bg-white text-raspanti-bordo w-full max-w-xs py-4 rounded-xl font-bold shadow-lg hover:bg-gray-100 transition">INGRESAR</button>
    </div>

    <div id="app-content" class="flex flex-col h-full hidden relative">
        
        <header class="bg-raspanti-bordo text-white p-4 flex justify-between items-center shadow-md z-20">
            <div class="flex items-center gap-3">
                <div class="bg-white text-raspanti-bordo font-black p-1 rounded">R</div>
                <span class="font-bold text-sm uppercase">Mi Agenda</span>
            </div>
            <button onclick="logout()" class="text-xs opacity-80">SALIR</button>
        </header>

        <main class="flex-1 overflow-y-auto p-4 pb-24 max-w-md mx-auto w-full no-scrollbar">
            
            <div id="view-dashboard" class="fade-in space-y-4">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <h2 class="text-xl font-bold text-raspanti-bordo">¡Hola Profe!</h2>
                    <p class="text-gray-500 text-sm" id="fecha-hoy">Cargando fecha...</p>
                </div>
                
                <div class="bg-raspanti-bordo text-white p-5 rounded-2xl shadow-lg">
                    <h3 class="font-bold mb-3 border-b border-white/20 pb-2">Hoy</h3>
                    <div id="lista-hoy" class="text-sm space-y-2">
                        </div>
                </div>
            </div>

            <div id="view-materias" class="hidden fade-in space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-raspanti-bordo">Mis Materias</h2>
                    <button onclick="openModal('modal-materia')" class="bg-raspanti-bordo text-white p-2 rounded-lg shadow"><i data-lucide="plus"></i></button>
                </div>
                <div id="lista-materias" class="space-y-3">
                    </div>
                <p id="no-materias" class="text-center text-gray-400 text-sm mt-10 hidden">No hay materias cargadas.</p>
            </div>

            <div id="view-aula" class="hidden fade-in space-y-4">
                <button onclick="nav('materias')" class="text-gray-500 text-xs font-bold flex items-center gap-1"><i data-lucide="arrow-left" class="w-3"></i> VOLVER</button>
                
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                    <span id="aula-modalidad" class="text-[10px] bg-raspanti-crema text-raspanti-bordo px-2 py-1 rounded font-bold uppercase">--</span>
                    <h2 id="aula-nombre" class="text-2xl font-black text-raspanti-bordo mt-2">Materia</h2>
                </div>

                <div class="flex bg-white p-1 rounded-xl shadow-sm border border-gray-100">
                    <button onclick="setTab('alumnos')" id="btn-alumnos" class="flex-1 py-2 text-xs font-bold rounded-lg bg-raspanti-crema text-raspanti-bordo">ALUMNOS</button>
                    <button onclick="setTab('notas')" id="btn-notas" class="flex-1 py-2 text-xs font-bold rounded-lg text-gray-400">NOTAS</button>
                </div>

                <div id="tab-alumnos" class="space-y-3">
                    <div class="flex justify-between items-center px-1">
                        <h3 class="font-bold text-gray-600 text-sm">Lista</h3>
                        <button onclick="openModal('modal-alumno')" class="text-xs bg-raspanti-dorado text-white px-3 py-1 rounded shadow font-bold">AGREGAR</button>
                    </div>
                    <div id="lista-alumnos" class="space-y-2"></div>
                </div>

                <div id="tab-notas" class="hidden space-y-3">
                    <div class="flex justify-between items-center px-1">
                        <h3 class="font-bold text-gray-600 text-sm">Exámenes</h3>
                        <button onclick="openModal('modal-examen')" class="text-xs bg-raspanti-bordo text-white px-3 py-1 rounded shadow font-bold">NUEVO</button>
                    </div>
                    <div class="overflow-x-auto bg-white rounded-xl border border-gray-100 shadow-sm">
                        <table class="w-full text-sm">
                            <thead><tr id="head-notas" class="bg-gray-50 text-gray-500 text-left"><th class="p-3">Alumno</th></tr></thead>
                            <tbody id="body-notas"></tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>

        <nav id="navbar" class="fixed bottom-0 w-full bg-white border-t border-gray-200 h-16 flex justify-around items-center z-30 pb-1">
            <button onclick="nav('dashboard')" id="nav-dash" class="flex flex-col items-center text-raspanti-bordo w-full h-full justify-center">
                <i data-lucide="layout-dashboard" class="w-5 mb-1"></i><span class="text-[10px] font-bold">Inicio</span>
            </button>
            <button onclick="nav('materias')" id="nav-mat" class="flex flex-col items-center text-gray-400 w-full h-full justify-center">
                <i data-lucide="book" class="w-5 mb-1"></i><span class="text-[10px] font-bold">Materias</span>
            </button>
        </nav>
    </div>

    <div id="modal-materia" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl">
            <h3 class="text-lg font-black text-raspanti-bordo mb-4">Nueva Materia</h3>
            <input id="input-mat-nombre" class="w-full p-3 bg-gray-50 rounded-lg mb-3 border font-bold" placeholder="Nombre (Ej: Matemática)">
            
            <label class="text-xs font-bold text-gray-500 ml-1">MODALIDAD</label>
            <select id="input-mat-mod" onchange="checkMod()" class="w-full p-3 bg-gray-50 rounded-lg mb-3 border">
                <option value="Presencial">Presencial</option>
                <option value="Virtual">Virtual</option>
                <option value="Asincronico">Asincrónico</option>
            </select>

            <div id="div-dias">
                <label class="text-xs font-bold text-gray-500 ml-1">DÍA</label>
                <select id="input-mat-dia" class="w-full p-3 bg-gray-50 rounded-lg mb-3 border">
                    <option>Lunes</option><option>Martes</option><option>Miércoles</option><option>Jueves</option><option>Viernes</option>
                </select>
            </div>

            <div class="flex gap-2 mt-4">
                <button onclick="closeModal('modal-materia')" class="flex-1 py-3 text-gray-500 font-bold">Cancelar</button>
                <button onclick="guardarMateria()" class="flex-1 py-3 bg-raspanti-bordo text-white rounded-lg font-bold shadow">Guardar</button>
            </div>
        </div>
    </div>

    <div id="modal-alumno" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl">
            <h3 class="text-lg font-black text-raspanti-bordo mb-4">Nuevo Alumno</h3>
            <input id="input-alum-ape" class="w-full p-3 bg-gray-50 rounded-lg mb-2 border font-bold" placeholder="Apellido">
            <input id="input-alum-nom" class="w-full p-3 bg-gray-50 rounded-lg mb-4 border font-bold" placeholder="Nombre">
            <div class="flex gap-2">
                <button onclick="closeModal('modal-alumno')" class="flex-1 py-3 text-gray-500 font-bold">Cancelar</button>
                <button onclick="guardarAlumno()" class="flex-1 py-3 bg-raspanti-dorado text-white rounded-lg font-bold shadow">Agregar</button>
            </div>
        </div>
    </div>

    <div id="modal-examen" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl">
            <h3 class="text-lg font-black text-raspanti-bordo mb-4">Nuevo Examen/TP</h3>
            <input id="input-exam-nom" class="w-full p-3 bg-gray-50 rounded-lg mb-3 border font-bold" placeholder="Nombre (Ej: TP 1)">
            <label class="text-xs font-bold text-gray-500 ml-1">FECHA</label>
            <input type="date" id="input-exam-date" class="w-full p-3 bg-gray-50 rounded-lg mb-4 border font-bold">
            <div class="flex gap-2">
                <button onclick="closeModal('modal-examen')" class="flex-1 py-3 text-gray-500 font-bold">Cancelar</button>
                <button onclick="guardarExamen()" class="flex-1 py-3 bg-raspanti-bordo text-white rounded-lg font-bold shadow">Crear</button>
            </div>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS LOCAL ---
        const DB = {
            get: () => JSON.parse(localStorage.getItem('raspanti_data')) || [],
            save: (data) => localStorage.setItem('raspanti_data', JSON.stringify(data))
        };

        let activeId = null;

        // --- INICIO ---
        lucide.createIcons();
        if(localStorage.getItem('raspanti_logged')) { 
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app-content').classList.remove('hidden');
            initDash();
        }

        // --- FUNCIONES ---
        function login() {
            localStorage.setItem('raspanti_logged', 'true');
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app-content').classList.remove('hidden');
            initDash();
        }
        function logout() {
            localStorage.removeItem('raspanti_logged');
            location.reload();
        }

        function nav(view) {
            ['dashboard','materias','aula'].forEach(id => document.getElementById('view-'+id).classList.add('hidden'));
            document.getElementById('view-'+view).classList.remove('hidden');
            
            // Navbar icons
            const d = document.getElementById('nav-dash');
            const m = document.getElementById('nav-mat');
            if(view === 'dashboard') {
                d.classList.replace('text-gray-400','text-raspanti-bordo');
                m.classList.replace('text-raspanti-bordo','text-gray-400');
                initDash();
            } else {
                m.classList.replace('text-gray-400','text-raspanti-bordo');
                d.classList.replace('text-raspanti-bordo','text-gray-400');
                if(view === 'materias') renderMaterias();
            }

            // Ocultar nav en aula
            if(view === 'aula') document.getElementById('navbar').classList.add('hidden');
            else document.getElementById('navbar').classList.remove('hidden');
        }

        function initDash() {
            const date = new Date();
            const dias = ['Domingo','Lunes','Martes','Miércoles','Jueves','Viernes','Sábado'];
            document.getElementById('fecha-hoy').innerText = `${dias[date.getDay()]}, ${date.getDate()}/${date.getMonth()+1}`;
            
            const data = DB.get();
            const hoy = dias[date.getDay()];
            const lista = document.getElementById('lista-hoy');
            lista.innerHTML = '';
            
            let hayAlgo = false;
            data.forEach(m => {
                // Clase hoy?
                if(m.modalidad !== 'Asincronico' && m.dia === hoy) {
                    lista.innerHTML += `<div class="bg-white/10 p-2 rounded flex items-center gap-2"><div class="w-2 h-2 bg-green-400 rounded-full"></div> <strong>${m.nombre}</strong> (Clase)</div>`;
                    hayAlgo = true;
                }
                // Examen hoy?
                const hoyISO = date.toISOString().split('T')[0];
                m.examenes.forEach(e => {
                    if(e.fecha === hoyISO) {
                        lista.innerHTML += `<div class="bg-white text-raspanti-bordo p-2 rounded flex items-center gap-2 font-bold"><div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div> EXAMEN: ${m.nombre} - ${e.nombre}</div>`;
                        hayAlgo = true;
                    }
                });
            });

            if(!hayAlgo) lista.innerHTML = '<span class="opacity-60 italic">No tienes actividades hoy.</span>';
        }

        // --- MATERIAS ---
        function checkMod() {
            const mod = document.getElementById('input-mat-mod').value;
            document.getElementById('div-dias').style.display = (mod === 'Asincronico') ? 'none' : 'block';
        }

        function guardarMateria() {
            const data = DB.get();
            data.push({
                id: Date.now(),
                nombre: document.getElementById('input-mat-nombre').value,
                modalidad: document.getElementById('input-mat-mod').value,
                dia: document.getElementById('input-mat-dia').value,
                alumnos: [],
                examenes: []
            });
            DB.save(data);
            closeModal('modal-materia');
            renderMaterias();
        }

        function renderMaterias() {
            const data = DB.get();
            const list = document.getElementById('lista-materias');
            list.innerHTML = '';
            if(data.length === 0) document.getElementById('no-materias').classList.remove('hidden');
            else document.getElementById('no-materias').classList.add('hidden');

            data.forEach(m => {
                const diaTxt = m.modalidad === 'Asincronico' ? 'Campus' : m.dia;
                const div = document.createElement('div');
                div.className = 'bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex justify-between items-center';
                div.innerHTML = `
                    <div onclick="abrirAula(${m.id})">
                        <h3 class="font-bold text-gray-800">${m.nombre}</h3>
                        <div class="text-xs text-gray-400 font-bold uppercase mt-1">${m.modalidad} • ${diaTxt}</div>
                    </div>
                    <button onclick="borrarMateria(${m.id})" class="text-gray-300 hover:text-red-500"><i data-lucide="trash-2" class="w-4"></i></button>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        function borrarMateria(id) {
            if(!confirm('¿Eliminar?')) return;
            let data = DB.get();
            data = data.filter(m => m.id !== id);
            DB.save(data);
            renderMaterias();
        }

        // --- AULA ---
        function abrirAula(id) {
            activeId = id;
            const m = DB.get().find(x => x.id === id);
            document.getElementById('aula-nombre').innerText = m.nombre;
            document.getElementById('aula-modalidad').innerText = m.modalidad;
            nav('aula');
            setTab('alumnos');
            renderAlumnos();
        }

        function setTab(t) {
            document.getElementById('tab-alumnos').classList.add('hidden');
            document.getElementById('tab-notas').classList.add('hidden');
            document.getElementById('tab-'+t).classList.remove('hidden');
            
            const btnA = document.getElementById('btn-alumnos');
            const btnN = document.getElementById('btn-notas');
            if(t==='alumnos'){
                btnA.classList.replace('text-gray-400','text-raspanti-bordo'); btnA.classList.add('bg-raspanti-crema');
                btnN.classList.replace('text-raspanti-bordo','text-gray-400'); btnN.classList.remove('bg-raspanti-crema');
            } else {
                btnN.classList.replace('text-gray-400','text-raspanti-bordo'); btnN.classList.add('bg-raspanti-crema');
                btnA.classList.replace('text-raspanti-bordo','text-gray-400'); btnA.classList.remove('bg-raspanti-crema');
                renderNotas();
            }
        }

        function guardarAlumno() {
            const data = DB.get();
            const m = data.find(x => x.id === activeId);
            m.alumnos.push({
                ape: document.getElementById('input-alum-ape').value,
                nom: document.getElementById('input-alum-nom').value,
                notas: {}
            });
            m.alumnos.sort((a,b) => a.ape.localeCompare(b.ape));
            DB.save(data);
            closeModal('modal-alumno');
            renderAlumnos();
        }

        function renderAlumnos() {
            const m = DB.get().find(x => x.id === activeId);
            const l = document.getElementById('lista-alumnos');
            l.innerHTML = '';
            m.alumnos.forEach((al, idx) => {
                l.innerHTML += `<div class="bg-white p-3 rounded-xl border border-gray-100 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-xs text-gray-500">${al.ape[0]}</div>
                        <span class="font-bold text-gray-700 text-sm">${al.ape}, ${al.nom}</span>
                    </div>
                    <button onclick="delAlum(${idx})" class="text-gray-300 hover:text-red-500"><i data-lucide="x" class="w-4"></i></button>
                </div>`;
            });
            lucide.createIcons();
        }

        function delAlum(idx) {
            if(!confirm('¿Quitar?')) return;
            const data = DB.get();
            const m = data.find(x => x.id === activeId);
            m.alumnos.splice(idx, 1);
            DB.save(data);
            renderAlumnos();
        }

        function guardarExamen() {
            const data = DB.get();
            const m = data.find(x => x.id === activeId);
            m.examenes.push({
                id: Date.now(),
                nombre: document.getElementById('input-exam-nom').value,
                fecha: document.getElementById('input-exam-date').value
            });
            DB.save(data);
            closeModal('modal-examen');
            renderNotas();
        }

        function renderNotas() {
            const m = DB.get().find(x => x.id === activeId);
            const head = document.getElementById('head-notas');
            const body = document.getElementById('body-notas');
            
            // Headers
            head.innerHTML = '<th class="p-3 sticky left-0 bg-gray-50">Alumno</th>';
            m.examenes.forEach(e => {
                const f = e.fecha ? e.fecha.split('-').reverse().slice(0,2).join('/') : '';
                head.innerHTML += `<th class="p-3 text-center min-w-[80px] text-xs">${e.nombre}<br><span class="font-normal opacity-50">${f}</span></th>`;
            });

            // Body
            body.innerHTML = '';
            m.alumnos.forEach((al, aIdx) => {
                let row = `<tr><td class="p-3 font-bold text-gray-700 sticky left-0 bg-white border-r text-sm truncate max-w-[120px]">${al.ape}, ${al.nom[0]}.</td>`;
                m.examenes.forEach(e => {
                    const val = al.notas[e.id] || '';
                    const color = (val && val<4) ? 'text-red-500 bg-red-50' : 'text-gray-700';
                    row += `<td class="p-2 text-center border-b"><input type="number" class="w-10 text-center p-1 rounded border ${color}" value="${val}" onchange="saveNota(${aIdx}, ${e.id}, this.value)"></td>`;
                });
                row += '</tr>';
                body.innerHTML += row;
            });
        }

        function saveNota(aIdx, eId, val) {
            const data = DB.get();
            const m = data.find(x => x.id === activeId);
            m.alumnos[aIdx].notas[eId] = val;
            DB.save(data);
            renderNotas(); // Refrescar color
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

    </script>
</body>
</html>


